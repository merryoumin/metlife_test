var HeaderModule = (function () {
    return {
        init: function () {
            // set height of header
            $(window).on("load resize", function () {
                var headerHeight = 0;
                var headerComponentClasses = [
                    "header",
                    "side-panel-navigation-subheader",
                    "content-filter-subheader",
                    "alert-message"
                ];
                if (UtilityModule.getViewport() !== "desktop") {
                    headerComponentClasses.push("promo-message");
                }
                headerComponentClasses.forEach(function (element) {
                    var $element = $("." + element);
                    if ($element.is(":visible")) {
                        headerHeight += $element.outerHeight() || 0;
                    }
                });

                $("body").css("padding-top", headerHeight + "px");
            });
        }
    };
})();
HeaderModule.init();
var HeaderNavigationModule = (function () {
    var hoverTimeout;
    var currentViewport = UtilityModule.getViewport();
    var ariaHiddenTrue;
    var ariaHiddenFalse;
    var activeElements;
    var minusTabindex;
    var zeroTabindex;

    function openNavigationMenu() {
        $(".navigation__menu").removeClass("nav-hidden").promise().done(function () {
            if (currentViewport != "desktop") {
                hamburgerDialogOpen();
            }
            if ($(".navigation__menu_mobile-nav-header").is(":visible") || $(".navigation__menu_mobile-utility").is(":visible")) {
                if ($(".navigation__menu_mobile-nav-header").is(":visible")) {
                    $(".header__logo-container a").focus();
                } else if ($(".navigation__menu_mobile-utility").is(":visible")) {
                    $(".header__login-trigger a").focus();
                }
                $(".navigation__menu").removeAttr("aria-label");
            }

        });

        if (UtilityModule.getViewport() != "desktop") {
            bodyScrollLock.disableBodyScroll($(".navigation__menu")[0]);
        }
    }

    $(".navigation__menu").on("keydown", function (event) {
        if ($(".navigation__menu_mobile-nav-header").is(":visible") || $(".navigation__menu_mobile-utility").is(":visible")) {
            if (event.keyCode === 27) {
                event.preventDefault();
                $("svg.icon.icon-close").trigger("click").promise().done(function () {
                    $("a.header__navigation-hamburger").focus();
                });
            }
        }
    });

    $("a.header__navigation-hamburger").focusin(function (evt) {
        $(this).on("keydown", function (evt) {
            if (evt.keyCode == 9 && !evt.shiftKey) {
                $(".header__logo-container a").attr("tabindex", "0");
                $(".header__logo-container a").focus();
            }
            if (evt.keyCode == 9 && evt.shiftKey) {
                $(".skip").focus();
            }
        });
    });

    function closeNavigationMenu() {
        $(".header__navigation-container-menu-item").removeClass("active").promise().done(function () {
            if (currentViewport != "desktop") {
                hamburgerDialogClose();
            }
        });
        $(".navigation__menu-row").addClass("d-md-none");
        $(".navigation__menu-row").addClass("d-lg-none");
        $(".navigation__featured-promo.navigation__menu-row").addClass("d-none");
        $(".navigation__menu").addClass("nav-hidden");
        bodyScrollLock.enableBodyScroll($(".navigation__menu")[0]);
    }

    function navigationTabEvent(tab) {
        var sectionIdentifier = tab.closest(".navigation__menu-row").attr("data-section");
        closeNavigationMenu();
        if ($(".navigation__menu").hasClass("nav-hidden")) {
            openNavigationMenu();
        }
        if (sectionIdentifier == "section1") {
            if ($(".header__navigation-container-menu-item[data-nav-section='section2']").length != 0) {
                $(".header__navigation-container-menu-item[data-nav-section='section1']").focus();
            }
        } else if (sectionIdentifier == "section2") {
            if ($(".header__navigation-container-menu-item[data-nav-section='section3']").length != 0) {
                $(".header__navigation-container-menu-item[data-nav-section='section2']").focus();
            }
        } else {
            $(".header__navigation-container-menu-item[data-nav-section='" + sectionIdentifier + "']").focus();
        }
    }

    function headerContainerHide() {
        $('.header__container').attr('aria-hidden', 'true');
        $('.header__container').css("display", "none");
        $('#skiptomaincontent').attr('aria-hidden', 'true');
        $('.skip').attr('tabindex', '-1');
        $('.header__logo-container').focus();
    }

    function headerContainerShow() {
        $('.header__container').removeAttr('aria-hidden');
        $('.header__container').css("display", "flex");
        $("a.header__navigation-hamburger").focus();
        $('#skiptomaincontent').attr('aria-hidden', 'false');
        $('.skip').removeAttr('tabindex');
        $('body').addClass('keyboard-active');
    }

    function headerNaviagtionMenu(currentElement) {
        $(".header__navigation-container-menu-item").removeClass("active");
        $(".header__navigation-container-menu-item").removeAttr("aria-live aria-atomic");
        closeNavigationMenu();
        $(".menu-state").text(":collapsed");
        if ($(".navigation__menu").hasClass("nav-hidden")) {
            openNavigationMenu();
            currentElement.attr({"aria-live": "assertive", "aria-atomic": true});
            currentElement.find('.menu-state').text(": expanded");
        }
        currentElement.addClass("active");
        var ariaLabelNav = currentElement.text().trim().split(':')[0].toTitleCase();
        $(".navigation__menu").attr("aria-label", ariaLabelNav);
        var sectionIdentifier = currentElement.closest(".header__navigation-container-menu-item").attr("data-nav-section");
        $('.navigation__menu-row' + '.' + sectionIdentifier).removeClass("d-lg-none");
        $('.navigation__menu-row' + '.' + sectionIdentifier).removeClass("d-md-none");
        $('.navigation__featured-promo.navigation__menu-row' + '.' + sectionIdentifier).removeClass("d-none");
        if ($('.navigation__menu-row' + '.' + sectionIdentifier).find(".navigation__menu-nested-nav-legend  .navigation__menu-nested-nav-legend-title:first-of-type").length != 0) {
            $('.navigation__menu-row' + '.' + sectionIdentifier).find(".navigation__menu-nested-nav-legend  .navigation__menu-nested-nav-legend-title:first-of-type").focus();
        } else {
            $('.navigation__menu-row' + '.' + sectionIdentifier).find(".navigation__menu-promo-content__container").find("[tabindex = '0'],a").first().focus();
        }
    }

    function headerContainerMenuItem(currentElement) {
        currentElement.closest(".navigation__menu-row").find(".navigation__menu-nested-nav-legend-title").removeClass("active");
        currentElement.closest(".navigation__menu-row").find(".navigation__menu-nested-nav-legend-title").attr("aria-pressed", false);
        currentElement.addClass("active");
        currentElement.attr("aria-pressed", true);
        var sectionIdentifier = currentElement.attr("data-section");
        currentElement.closest(".navigation__menu-row").find(".navigation__menu-nested-nav-link-section-column").removeClass("active");
        currentElement.closest(".navigation__menu-row").find(".navigation__menu-nested-nav-link-section-column").stop(true, false).delay(250).animate({'opacity': 0}, 500);
        currentElement.closest(".navigation__menu-row").find(".navigation__menu-nested-nav-link-section-column[data-section-title='" + sectionIdentifier + "']").addClass("active");
        currentElement.closest(".navigation__menu-row").find(".navigation__menu-nested-nav-link-section-column[data-section-title='" + sectionIdentifier + "']").stop(true, false).delay(250).animate({'opacity': 1}, 500);
    }

    function nonSubMenuCategory() {
        $(".navigation__menu-nested-nav-legend-title").not(".category").each(function (a) {
            $(this).removeAttr("role aria-controls aria-label");
        });
        $(".navigation__menu-nested-nav-legend-title.category").each(function (a) {
            $(this).attr("aria-pressed", false);
        });
        $(".navigation__menu-nested-nav-legend-title.category.active").each(function () {
            $(this).attr("aria-pressed", true);
        });
    }

    function hamburgerDialogOpen() {
        ariaHiddenTrue = $('[aria-hidden="true"]');
        ariaHiddenFalse = $('[aria-hidden="false"]');
        activeElements = $("a, input, select, textarea, button").not("nav.navigation__menu a, nav.navigation__menu input, nav.navigation__menu select, nav.navigation__menu textarea, nav.navigation__menu button");
        minusTabindex = $('[tabindex = "-1"]').not("nav.navigation__menu [tabindex = '-1']");
        zeroTabindex = $('[tabindex = "0"]').not("nav.navigation__menu [tabindex = '0']");
        activeElements.attr("tabindex", "-1");
        zeroTabindex.attr("tabindex", "-1");
        $('*').not('html, body, nav.navigation__menu, nav.navigation__menu *').attr('aria-hidden', true).promise().done(function () {
            searchDialogException();
        });

    }

    function hamburgerDialogClose() {
        $('*').not('html body, nav.navigation__menu, nav.navigation__menu *').removeAttr('aria-hidden');
        ariaHiddenTrue !== undefined && ariaHiddenTrue.attr('aria-hidden', true);
        ariaHiddenFalse !== undefined && ariaHiddenFalse.attr('aria-hidden', false);
        activeElements !== undefined && activeElements.removeAttr("tabindex");
        minusTabindex !== undefined && minusTabindex.removeAttr("tabindex");
        zeroTabindex !== undefined && zeroTabindex.removeAttr("tabindex");
        minusTabindex !== undefined && minusTabindex.attr("tabindex", "-1");
        zeroTabindex !== undefined && zeroTabindex.attr("tabindex", "0");
    }

    function searchDialogException() {
        $("section.header__search-overlay-section").removeAttr("aria-hidden");
    }

    return {
        init: function () {
            nonSubMenuCategory();
            $("a.header__navigation-hamburger svg").css("pointer-events", "none");
            $(window).on("resize", function (e) {
                var newViewport = UtilityModule.getViewport();
                $('.navigation__menu-nested-nav-legend-title.category').each(function (index) {
                    $(this).attr("aria-pressed", false);
                    $(this).attr("aria-controls", $(this).attr('aria-label'));
                });
                if (newViewport == "desktop" && currentViewport != "desktop") {
                    closeNavigationMenu();
                }
                currentViewport = newViewport;
            });

            $("a.header__navigation-hamburger").on("click touchstart", function (event) {
                event.preventDefault();
                event.stopPropagation();
                if ($(".navigation__menu").length != 0) {
                    openNavigationMenu();
                }
                headerContainerHide();
            });

            $("a.header__navigation-hamburger").on("keydown", function (event) {
                event.preventDefault();
                event.stopPropagation();
                if (event.which === 13 || event.which === 27 || event.which === 32) {
                    if ($(".navigation__menu").length != 0) {
                        if ($(".navigation__menu").hasClass("nav-hidden")) {
                            openNavigationMenu();
                        } else {
                            closeNavigationMenu();
                        }
                    }
                    headerContainerHide();
                }
            });

            $(".navigation__menu_mobile-nav-header .icon-close, .navigation__menu_mobile-utility .icon-close, .header__search-overlay .icon-close").on("click", function () {
                closeNavigationMenu();
                headerContainerShow();
            });
            $(".navigation__menu .container").on("click touchstart",function(event){
                  if(UtilityModule.getViewport() == "tablet"){
                      event.stopPropagation();
                  }     
             });

            $(".navigation__menu").on("click touchstart",function(event){
                if(UtilityModule.getViewport() == "tablet"){
					closeNavigationMenu();
                	headerContainerShow();
                }     
            });

            $(".navigation__menu_mobile-nav-header .icon-close, .navigation__menu_mobile-utility .icon-close, .header__search-overlay .icon-close").on("keydown", function (evt) {
                if (evt.which === 13 || evt.which === 32) {
                    evt.preventDefault();
                    closeNavigationMenu();
                    headerContainerShow();
                }
            });

            $(".header__navigation-container-menu-item").hover(function (e) {
                clearTimeout(hoverTimeout);
                $(".header__navigation-container-menu-item").removeClass("active");
                closeNavigationMenu();
                if ($(".navigation__menu").hasClass("nav-hidden")) {
                    openNavigationMenu();
                }
                $(this).addClass("active");
                var ariaLabelNav = $(this).text().trim().split(':')[0].toTitleCase();
                $(".navigation__menu").attr("aria-label", ariaLabelNav);
                var sectionIdentifier = $(this).closest(".header__navigation-container-menu-item").attr("data-nav-section");
                $('.navigation__menu-row' + '.' + sectionIdentifier).removeClass("d-lg-none");
                $('.navigation__menu-row' + '.' + sectionIdentifier).removeClass("d-md-none");
                $('.navigation__featured-promo.navigation__menu-row' + '.' + sectionIdentifier).removeClass("d-none");
            }).on("mouseleave", function (evt) {
                clearTimeout(hoverTimeout);
                hoverTimeout = setTimeout(function () {
                    if (!$('.navigation__menu').is(":hover")) {
                        closeNavigationMenu();
                    }
                }, 50);
            }).on("focus", function (evt) {
                $(".header__navigation-container-menu-item").removeAttr("aria-live aria-atomic");
                $(this).attr({"aria-live": "assertive", "aria-atomic": true});
                closeNavigationMenu();
                $(".menu-state").text(': collapsed');
            }).on("keyup", function (evt) {
                if (evt.keyCode === 13 || evt.keyCode === 32) {
                    headerNaviagtionMenu($(this));
                }
            }).on("click", function () {
                headerNaviagtionMenu($(this));
            });

            $('.navigation__menu-nested-nav-legend-title').on("keydown", function (evt) {
                if (evt.keyCode === 13 || evt.keyCode === 32) {
                    $('.navigation__menu-nested-nav-legend-title').click();
                }
            });

            $('.navigation__menu').on('mouseleave', function () {
                if (UtilityModule.getViewport() == "desktop") {
                    closeNavigationMenu();
                }
            });


            $(".header__navigation-container-menu-item:first-of-type").on("keydown", function (evt) {
                if (evt.keyCode === 9 && evt.shiftKey) {
                    closeNavigationMenu();
                    if ($(".navigation__menu").hasClass("nav-hidden")) {
                        openNavigationMenu();
                    }
                }
            });

            $(".header__navigation-container-menu-item:last-of-type").on("keydown", function (evt) {
                if (evt.keyCode === 9) {
                    closeNavigationMenu();
                    if ($(".navigation__menu").hasClass("nav-hidden")) {
                        openNavigationMenu();
                    }
                }
            });

            $(".navigation__menu-nested-nav-link-section-column .navigation__menu-nested-nav-link-section-column-links:last-child .navigation__menu-nested-nav-link-section-column-links--link:last-of-type a").on("keydown", function (evt) {
                if (evt.keyCode === 9 && !evt.shiftKey) {
                    navigationTabEvent($(this));
                }
            });

            $(".navigation__menu-nestedLinkList .navigation__menu-nestedLinkList-section:last-child .navigation__menu-nested-nav-link-section-column-links .navigation__menu-list-nestedLinks-section-link:last-of-type a").on("keydown", function (evt) {
                if (evt.keyCode === 9 && !evt.shiftKey) {
                    navigationTabEvent($(this));
                }
            });

            $(".navigation__menu-nested-nav-legend-title.category").hover(function () {
                $(this).closest(".navigation__menu-row").find(".navigation__menu-nested-nav-legend-title").removeClass("active");
                $(this).closest(".navigation__menu-row").find(".navigation__menu-nested-nav-legend-title").attr("aria-pressed", false);
                $(this).addClass("active");
                $(this).attr("aria-pressed", true);
                var sectionIdentifier = $(this).attr("data-section");
                $(this).closest(".navigation__menu-row").find(".navigation__menu-nested-nav-link-section-column").removeClass("active");
                $(this).closest(".navigation__menu-row").find(".navigation__menu-nested-nav-link-section-column").stop(true, false).delay(250).animate({'opacity': 0}, 500);
                $(this).closest(".navigation__menu-row").find(".navigation__menu-nested-nav-link-section-column[data-section-title='" + sectionIdentifier + "']").addClass("active");
                $(this).closest(".navigation__menu-row").find(".navigation__menu-nested-nav-link-section-column[data-section-title='" + sectionIdentifier + "']").stop(true, false).delay(250).animate({'opacity': 1}, 500);
            }).on("keydown", function (evt) {
                if ((evt.which === 13 || evt.which === 32)) {
                    if (evt.shiftKey !== true) {
                        headerContainerMenuItem($(this));
                    }
                }
            }).on("click", function (evt) {
                headerContainerMenuItem($(this));
            });

            $(".navigation__menu-nested-nav-link-section-mobile-title").on("click", function (evt) {
                var sectionIdentifier = $(this).attr("data-section-title");
                if ($(this).hasClass("expanded")) {
                    $(this).removeClass("expanded");
                    evt.target.setAttribute("aria-expanded", false);
                    $(".navigation__menu-nested-nav-link-section-column[data-section-title='" + sectionIdentifier + "']").find(".navigation__menu-nested-nav-link-section-column-links").slideUp(400);
                    $(".navigation__menu-nested-nav-link-section-column-links[data-section-title='" + sectionIdentifier + "']").slideUp(400);
                } else {
                    $(this).addClass("expanded");
                    evt.target.setAttribute("aria-expanded", true);
                    $(".navigation__menu-nested-nav-link-section-column[data-section-title='" + sectionIdentifier + "']").find(".navigation__menu-nested-nav-link-section-column-links").slideDown(400);
                    $(".navigation__menu-nested-nav-link-section-column-links[data-section-title='" + sectionIdentifier + "']").slideDown(400);
                }
            }).on("keydown", function (evt) {
                if ((evt.which === 13 || evt.which === 32)) {
                    if (evt.shiftKey !== true) {
                        var sectionIdentifier = $(this).attr("data-section-title");
                        if ($(this).hasClass("expanded")) {
                            $(this).removeClass("expanded");
                            evt.target.setAttribute("aria-expanded", false);
                            $(".navigation__menu-nested-nav-link-section-column[data-section-title='" + sectionIdentifier + "']").find(".navigation__menu-nested-nav-link-section-column-links").slideUp(400);
                            $(".navigation__menu-nested-nav-link-section-column-links[data-section-title='" + sectionIdentifier + "']").slideUp(400);
                        } else {
                            $(this).addClass("expanded");
                            evt.target.setAttribute("aria-expanded", true);
                            $(".navigation__menu-nested-nav-link-section-column[data-section-title='" + sectionIdentifier + "']").find(".navigation__menu-nested-nav-link-section-column-links").slideDown(400);
                            $(".navigation__menu-nested-nav-link-section-column-links[data-section-title='" + sectionIdentifier + "']").slideDown(400);
                        }
                    }
                }
            });

            $("body").on("click touchstart", function (e) {
                if (UtilityModule.getViewport() == "desktop") {
                    if ($(".navigation__menu-row").is(":visible")) {
                        if ($(e.target).closest(".header__navigation-container").length == 0) {
                            if ($(e.target).closest(".navigation__menu").length == 0) {
                                closeNavigationMenu();
                            }
                        }
                    }
                }
                if (UtilityModule.getViewport() == "tablet") {
                    if ($(".navigation__menu-row").is(":visible")) {
                        if ($(e.target).closest(".container").length == 0) {
                            closeNavigationMenu();
                        }
                    }
                }
            });

            $(".navigation__menu-row a").on("click", function (evt) {
                var section = $(this).parents(".navigation__menu-row").attr("data-section");
                var title = $("[data-nav-section='" + section + "']").find(".header__navigation-container-menu-item-title").text().trim();
                AnalyticsModule.linkClick(title, "Global Top Navigation", $(this).text().trim());
            });

            $(document).on('keydown', '.navigation__menu-linkList .navigation__menu-list-links:last-of-type', function (evt) {
                if (evt.keyCode === 9 && !evt.shiftKey && UtilityModule.getViewport() == "desktop") {
                    navigationTabEvent($(this));
                }
            });

            $(document).on('keydown', '.navigation__menu-promo-content__container .navigation__menu-promo-content-cta:last-of-type', function (evt) {
                if ((evt.keyCode === 9 && !evt.shiftKey) && ($(this).parents('.navigation__menu-promo-content').siblings('.navigation__menu-nestedLinkList').length == 0)) {
                    navigationTabEvent($(this));
                }
            });
        },
        closeNavigationMenu: closeNavigationMenu,
        navigationTabEvent: navigationTabEvent
    };
})();
HeaderNavigationModule.init();

var HeaderAccessibilityModule = (function () {
    return {
        init: function () {
            $("a.skip").on({
                "focus": function () {
                    $(".header").css("top", "40px");
                },
                "blur": function () {
                    $(".header").css("top", "0px");

                },
                "click": function () {
                    $("#skiptomaincontent").focus();
                },
                "keydown": function (e) {
                    if (e.keyCode === 13 || e.keyCode === 32) {
                        $("#skiptomaincontent").focus();
                    }
                }
            });
        }
    };
})();
HeaderAccessibilityModule.init();
var HeaderLanguageModule = (function () {
    var languageLink = $('.header__language-container-list li a');

    return {
        init: function () {
            if ($(".header__language-container").length != 0) {
                $("body").addClass("language-selector-enabled");
            }

            languageLink.on('click', function () {
                if ($(this).attr('href') === "#") {
                    $(".language-error-overlay").show();
                    $("body").addClass("modal-open");
                } else {
                    $('.language-trigger__label span').html($(this).html());
                    languageLink.attr('data-default', '');
                    languageLink.css('text-decoration', 'none');
                    var currentElem = ($(this).attr('data-label'));
                    $('.global-header .language-dropdown-list').find("a[data-label='" + currentElem + "']").css('text-decoration', 'underline').attr('data-default', 'true');
                    $('.megamenu .language-dropdown-list').find("a[data-label='" + currentElem + "']").css('text-decoration', 'underline').attr('data-default', 'true');
                    $('.subnav .language-dropdown-list').find("a[data-label='" + currentElem + "']").css('text-decoration', 'underline').attr('data-default', 'true');
                    $('.campaign-header .language-dropdown-list').find("a[data-label='" + currentElem + "']").css('text-decoration', 'underline').attr('data-default', 'true');
                    window.location.href = $(this).attr('href');
                }
            });

            $('.language-error-overlay .js-close-error-overlay').on("click", function (evt) {
                evt.preventDefault();
                $(".language-error-overlay").hide();
                $("body").removeClass("modal-open");
            }).on("keydown", function (evt) {
                if (evt.which === 13 || evt.which === 27) {
                    e.preventDefault();
                    $(".language-error-overlay").hide();
                    $("body").removeClass("modal-open");
                }
            });
        }
    };
})();
HeaderLanguageModule.init();
var HeaderLoginModule = (function () {
    var headerLoginContainer = $(".header__login-container");

    function openLogin() {
        $('.login-container').show();
        bodyScrollLock.disableBodyScroll($(".login-container")[0]);
        HeaderNavigationModule.closeNavigationMenu();
        aria_hide_others();
    }

    function tabFocus(FirstElementStr, LastElementStr) {
        $(FirstElementStr).on('keydown', function (e) {
            var isTabPressed = e.key === 'Tab' || e.keyCode === 9;
            if (!isTabPressed) {
                return;
            }
            if (isTabPressed && !e.shiftKey) {
                e.preventDefault();
                $(LastElementStr).attr('tabindex', '0').focus();
            }
        });
        $(LastElementStr).on('keydown', function (e) {
            var isTabPressed = e.key === 'Tab' || e.keyCode === 9;
            if (isTabPressed && e.shiftKey) {
                e.preventDefault();
                var showHide = $('.login-type-trigger__title:not(.login-type-trigger__title--open)').length;
                if (showHide) {
                    $('.login-type-trigger__title:not(.login-type-trigger__title--open)').focus();
                } else {
                    $(FirstElementStr).attr('tabindex', '0').focus();
                }

            }
        });
    }

    tabFocus('#loginFooterID', '.login-container--close');

    var primaryLinks = $('.login-type__details');
    var primaryLinksCategoryLabel = primaryLinks.find('.login-type__detail');
    var primaryLinksCategoryContainer = primaryLinks.find('.login-type__detail ul');

    function openPrimaryLinks(primaryLinksCategory, primaryLinksCategoryContainer, primaryLinksSelectedItem) {
        primaryLinksCategoryLabel.addClass("login-type__detail--open");
        primaryLinksCategoryContainer.slideDown(400);
        $('.login_expand_collapse_announcement').text($('.loginFooterExpand').val());
    }

    function closePrimaryLinks(primaryLinksCategory, primaryLinksCategoryContainer, primaryLinksSelectedItem) {
        primaryLinksCategoryLabel.removeClass("login-type__detail--open");
        primaryLinksCategoryContainer.slideUp(400);
        $('.login_expand_collapse_announcement').text($('.loginFooterCollapse').val());
    }

    function setTabIndex() {
        if (UtilityModule.getViewport() == "mobile") {
            primaryLinksCategoryLabel.attr("tabindex", 0);
            primaryLinksCategoryLabel.attr("role", 'menu');
        } else {
            primaryLinksCategoryLabel.removeAttr("tabindex");
            primaryLinksCategoryLabel.removeAttr("role");
            primaryLinksCategoryLabel.removeAttr("aria-expanded");
        }
    }
    
    function aria_hide_others() {
        $(".login-form-in-header").siblings(":not(script)").each(function(index,element) {
            var $aria_hidden_value = $(element).attr("aria-hidden");
            var $aria_hidden_undefined = !$aria_hidden_value;
            if (!$aria_hidden_undefined) {
                $(element).attr({
                    "data-aria-hidden": $aria_hidden_value,
                    "aria-hidden": true
                });
            } else {
                $(element).attr({
                    "aria-hidden": true
                });
            }
            $(element).find("*").each(function(key,selector) {
                var $tabindex = $(selector).attr("tabindex");
                var $tabindex_undefined = !$tabindex;
                if (!$tabindex_undefined) {
                    $(selector).attr({
                        "data-tabindex": $tabindex,
                        "tabindex": -1
                    });
                } else {
                    $(selector).attr({
                        "tabindex": -1
                    });
                }
            });
        });
    }

    function aria_show_all() {
        $(".login-form-in-header").siblings(":not(script)").each(function(index,element) {
            var $aria_hidden_value = $(element).attr("data-aria-hidden");
            var $aria_hidden_undefined = !$aria_hidden_value;
            if (!$aria_hidden_undefined) {
                $(element).attr({
                    "aria-hidden": $aria_hidden_value
                }).removeAttr("data-aria-hidden");
            } else {
                $(element).removeAttr("aria-hidden");
            }
            $(element).find("*").each(function(key, selector) {
                var $tabindex = $(selector).attr("data-tabindex");
                var $tabindex_undefined = !$tabindex;
                if (!$tabindex_undefined) {
                    $(selector).attr({
                        "tabindex": $tabindex
                    }).removeAttr("data-tabindex");
                } else {
                    $(selector).removeAttr("tabindex");
                }
            });
        });
    }

    return {
        init: function () {
            setTabIndex();
            $(window).on("resize", function () {
                setTabIndex();
            });

            if (UtilityModule.getViewport() == "mobile") {
            	primaryLinksCategoryLabel.on("touchstart focus", function (evt) {
					$(this).removeAttr("aria-label");
                    $(this).attr("aria-label",$(this).find('h3').text()+" "+$('.loginFooterCollapse').val());
                });
                primaryLinksCategoryLabel.on("click keyup keydown", function (evt) {
                    var primaryLinksCategory = $(this);
                    var primaryLinksCategoryContainer = $(this).find("ul");
                    var primaryLinksSelectedItem = $(this);
                    if (evt.type == 'keyup') {
                        if (evt.which == 13 || evt.which == 32) {
                            if (primaryLinksCategoryContainer.is(":visible") != true) {
                                openPrimaryLinks(primaryLinksCategory, primaryLinksCategoryContainer, primaryLinksSelectedItem);
                            } else {
                                closePrimaryLinks(primaryLinksCategory, primaryLinksCategoryContainer, primaryLinksSelectedItem);
                            }
                        }
                    } else if (evt.type == 'keydown') {
                        if (evt.which == 9 && evt.shiftKey == true) {
                            if (primaryLinksCategoryContainer.is(":visible") == true) {
                                closePrimaryLinks(primaryLinksCategory, primaryLinksCategoryContainer, primaryLinksSelectedItem);
                            }
                        }
                    } else {
                        if (primaryLinksCategoryContainer.is(":visible") != true) {
                            openPrimaryLinks(primaryLinksCategory, primaryLinksCategoryContainer, primaryLinksSelectedItem);
                        } else {
                            closePrimaryLinks(primaryLinksCategory, primaryLinksCategoryContainer, primaryLinksSelectedItem);
                        }
                    }
                });
            }


            $('.header__login-trigger-label').on("click", function (evt) {
                if (!$(this).closest('.header__login-trigger').hasClass("linkOnly")) {
                    evt.preventDefault();
                    if($(this).parents('header').hasClass('header')){
						 $('.login-container').show();
						 bodyScrollLock.disableBodyScroll($(".login-container")[0]);
                         aria_hide_others();
                    }else{
						 openLogin();
                    }
                    $('.login-container--close').focus();
                }
            });

            $(document).on('keydown', '.login-container--close', function (e) {
                if ((e.keyCode === 13 || e.keyCode === 32)) {
                    e.preventDefault();
                    $('.login-container').hide();
                    aria_show_all();
                    $('.header__login-trigger-label').attr('tabindex', 0).focus();
                }
            });
            
            $(document).on('click','.login-container--close', function (e) {
            	aria_show_all();
            	$('.header__login-trigger-label').attr('tabindex',0).focus();         
	       });

			
            $(document).on('keydown', '.login-type-trigger__title:not(.login-type-trigger__title--open)', function (e) {
                var isTabPressed = e.key === 'Tab' || e.keyCode === 9;
                if (!isTabPressed) {
                    return;
                }
                if (isTabPressed && !e.shiftKey) {
                    e.preventDefault();
                    $('.login-container--close').attr('tabindex', '0').focus();
                }
            });

            if (UtilityModule.getUrlParameter("login") == "true") {
                if ($('.header__login-trigger-label').length > 0 && !$(".header__login-trigger").hasClass("linkOnly")) {
                    $(".header__login-trigger-label").trigger("click");
                }
            }

            headerLoginContainer.find(".header__login-trigger-label").on("click", function (evt) {
                AnalyticsModule.linkClick("", "Global Top Navigation", $(this).find(".header__login-label").text().trim());
            });
        }
    };
})();
HeaderLoginModule.init();
var HeaderLogoModule = (function () {
    return {
        init: function () {
            $(".header__logo-container a").on("click", function (evt) {
                AnalyticsModule.linkClick("", "Global Top Navigation", $(this).text().trim());
            });
        }
    };
})();
HeaderLogoModule.init();
var HeaderSearchModule = (function () {
    var headerSearchContainer = $(".header__search-container");

    function searchDialogVisibleChildrenException() {
        $("section.header__search-overlay-section").find("[tabindex='-1'], [aria-hidden='true']").each(function (key, value) {
            $(value).removeAttr("aria-hidden");
            if ($(value).attr("tabindex") < 0) {
                $(value).removeAttr("tabindex");
            }
        });
    }

    return {
        init: function () {
            $(window).on("load resize", function () {
                if (UtilityModule.getViewport() == "mobile") {
                    $(".header__utilities .header__search-container").attr('aria-hidden', 'true');
                    $(".header__utilities .header__search-container").attr('tabindex', '-1');
                } else {
                    $(".header__utilities .header__search-container").attr('aria-hidden', 'false');
                    $(".header__utilities .header__search-container").attr('tabindex', '0');
                }
            });

            function searchFocus(first_element, last_element) {
                $(first_element).on("keydown", function (e) {
                    if (e.keyCode == 9 && e.shiftKey) {
                        e.preventDefault();
                        $(last_element).focus();
                    }
                });

                $(last_element).on("keydown", function (e) {
                    if (e.keyCode == 9 && e.shiftKey) {
                        e.preventDefault();
                         $(".header__search-overlay #searchInPage").focus();                       

                    }else if(e.keyCode == 9 && !e.shiftKey){
                        if(!$(".overlay-search-results-container").hasClass("searchClicked")){
                        	e.preventDefault();
                        	$(first_element).focus();
                        }
                    }
                });
                aria_hide_others(".header__search-overlay-section");
            }

            function aria_show_all(active_element_str) {
                var child_elements = '*';
                if ($(active_element_str).length) {
                    $(active_element_str).siblings(":not(script)").each(function (index, element) {
                        if ($(element).length) {
                            var $aria_hidden_value = $(element).attr("data-aria-hidden");
                            var $aria_hidden_undefined = !$aria_hidden_value;
                            if (!$aria_hidden_undefined) {
                                $(element).attr({
                                    "aria-hidden": $aria_hidden_value
                                }).removeAttr("data-aria-hidden");
                            } else {
                                $(element).removeAttr("aria-hidden");
                            }


                            $(element).find("*").each(function (key, selector_element) {
                                var data_tabindex = $(selector_element).attr("data-tabindex");
                                var data1_tabindex = $(selector_element).attr("neg_tabindex");
                                var negtab = $(selector_element).attr("no_tabindex");
                                if (data1_tabindex == -1) {
                                    $(selector_element).attr({
                                        "tabindex": -1
                                    }).removeAttr("neg_tabindex");
                                }
                                if (data_tabindex == 0) {
                                    $(selector_element).attr({
                                        "tabindex": 0
                                    }).removeAttr("data-tabindex");
                                }
                                if (negtab == 'notabindex') {
                                    $(selector_element).removeAttr('tabindex');
                                    $(selector_element).removeAttr("no_tabindex");
                                }
                            });

                        }
                    });
                }
            }

            function aria_hide_others(active_element_str) {
                var child_elements = '*';
                if ($(active_element_str).length) {
                    $(active_element_str).siblings(":not(script)").each(function (index, element) {
                        if ($(element).length) {
                            var $aria_hidden_value = $(element).attr("aria-hidden");
                            var $aria_hidden_undefined = !$aria_hidden_value;
                            if (!$aria_hidden_undefined) {
                                $(element).attr({
                                    "data-aria-hidden": $aria_hidden_value,
                                    "aria-hidden": true
                                });
                            } else {
                                $(element).attr({
                                    "aria-hidden": true
                                });
                            }

                            $(element).find("*").each(function (key, selector_element) {
                                var $tabindex = $(selector_element).attr("tabindex");
                                if ($tabindex == 0) {
                                    $(selector_element).attr({
                                        "data-tabindex": $tabindex,
                                        "tabindex": -1
                                    });
                                } else if ($tabindex == -1) {
                                    $(selector_element).attr({
                                        "neg_tabindex": $tabindex,
                                        "tabindex": -1
                                    });
                                } else if ($tabindex == undefined) {
                                    $(selector_element).attr({
                                        "no_tabindex": 'notabindex',
                                        "tabindex": -1,
                                    });
                                }
                            });
                        }
                    });
                }
            }

            $(".header__search-container").on({
                click: function (e) {
                    $(".header__search-overlay").removeClass("d-none");                   
                    $("#search-overlay").attr('aria-hidden', 'false');
                    $(".search-overlay__close a").attr('aria-hidden', 'false');
                    $(".search-overlay__close a").attr('tabindex', '0');
                    bodyScrollLock.disableBodyScroll($(".header__search-overlay")[0]);
                    $(".header__search-overlay .search-overlay__close a").focus();
                    searchFocus('.header__search-overlay .search-overlay__close > a', '.header__search-overlay .search_location_image');
                    searchDialogVisibleChildrenException();

                }, keydown: function (e) {
                    var key = e.keyCode;
                    if (key == 13 || key == 32) {
                        e.preventDefault();
                        $(".header__search-overlay").removeClass("d-none");                        
                        $("#search-overlay").attr('aria-hidden', 'false');
                        $(".search-overlay__close a").attr('aria-hidden', 'false');
                        $(".search-overlay__close a").attr('tabindex', '0');
                        bodyScrollLock.disableBodyScroll($(".header__search-overlay")[0]);
                        $(".header__search-overlay .search-overlay__close a").focus();
                        searchFocus('.header__search-overlay .search-overlay__close > a', '.header__search-overlay .search_location_image');
                        searchDialogVisibleChildrenException();
                    }
                }
            });


            $(".header__search-overlay .search-overlay__close").on({
                click: function (e) {
                    $(this).closest(".header__search-overlay").addClass("d-none");
                    bodyScrollLock.enableBodyScroll($(".header__search-overlay")[0]);
                    $("#searchInPage").val("");
                    $(".results_content").remove();
                    $('.results_pagination').addClass('d-none');
                    $('.display-text ').addClass('d-none');
                    $('.no-results ').addClass('d-none');
                    $('.search-results-container__correction-text ').addClass('d-none');
                    $(".search-trigger").removeClass("error");
                    $(".search-trigger").removeClass("search-initiated");
                    $(".popular-search-container").removeClass("d-none");
                    clear_suggestions();
                    $(".header__search-container").focus();
                    aria_show_all(".header__search-overlay-section");
					$(".overlay-search-results-container").removeClass("searchClicked");

                }, keypress: function (e) {
                    var key = e.which;
                    if (key == 13 || key == 32) {
                        $(this).closest(".header__search-overlay").addClass("d-none");
                        bodyScrollLock.enableBodyScroll($(".header__search-overlay")[0]);
                        $("#searchInPage").val("");
                        $(".results_content").remove();
                        $('.results_pagination').addClass('d-none');
                        $('.display-text ').addClass('d-none');
                        $('.no-results ').addClass('d-none');
                        $('.search-results-container__correction-text ').addClass('d-none');
                        $(".search-trigger").removeClass("error");
                        $(".search-trigger").removeClass("search-initiated");
                        $(".popular-search-container").removeClass("d-none");
                        clear_suggestions();
                        $(".header__search-container").focus();
                        aria_show_all(".header__search-overlay-section");
						$(".overlay-search-results-container").removeClass("searchClicked");
                    }
                }
            });

            headerSearchContainer.find(".header__search-trigger").on("click", function (evt) {
                AnalyticsModule.linkClick("", "Global Top Navigation", $(this).find(".header__search-label").text().trim());
            });
        }
    };
})();
HeaderSearchModule.init();

if ($(".header__search-overlay #isLucene").val() != 'undefined' && $(".header__search-overlay #isLucene").val() != null && $(".header__search-overlay #isLucene").val()) {
    var searchListCount = parseInt($(".page-count option:eq(0)").val());
    var searchMaxPagCount;
    if (UtilityModule.getViewport() == "mobile") {
        searchMaxPagCount = 3;
    } else {
        searchMaxPagCount = 5;
    }

    var LuceneSearchModule = (function () {
        var numSearchResults = 10;
        var searchPaginationNumber;
        var searchPaginationPrev;
        var queryString;
        var searchRequest;
        var searchStart = 1;
        var searchEnd = 10;
        var totalSearchResults = 0;
        var didYouMean = null;
        var searchCounter = 1;
        var defaultNoResultsMsg = $(".no-results").html();
        var viewportOld = UtilityModule.getViewport();
        var viewportNew;
        var currentText = $(".results_pagination").data("current-text");
        var goToText = $(".results_pagination").data("goto-text");

        function trapTab() {
            var close_button_selector = ".header__search-overlay .search-overlay__close > a",
                search_link = ".header__search-overlay #homepage__global-searchLink",
                no_results = ".header__search-overlay .no-results a",
                last_element_selector_string = ".header__search-overlay .results_pagination .last a",
                last_element_correction_text = ".header__search-overlay .search-results-container__correction-text .font-body-3 a";


            var conditional_first_lastElement = {
                "search_not_pressed": {
                    "first_element": close_button_selector,
                    "last_element": search_link
                },
                "search_successful_one_result": {
                    "first_element": close_button_selector,
                    "last_element": last_element_correction_text
                },
                "search_successful_many_results": {
                    "first_element": close_button_selector,
                    "last_element": last_element_selector_string
                },
                "search_unsuccessful": {
                    "first_element": close_button_selector,
                    "last_element": no_results
                }
            };

            var occured_condition = fetchOccuredCondition();
            var elements_to_trap = conditional_first_lastElement[occured_condition];
            var first_element = $(elements_to_trap.first_element);
            var last_element = $(elements_to_trap.last_element);
            for (var cond in conditional_first_lastElement) {
                $(conditional_first_lastElement[cond].last_element).unbind("keydown");
            }
            first_element.bind("keydown", function (e) {
                if (e.keyCode == 9 && e.shiftKey) {
                    e.preventDefault();
                    last_element.focus();
                }
            });

            last_element.bind("keydown", function (e) {
                if (e.keyCode == 9 && !e.shiftKey) {
                    e.preventDefault();
                    first_element.focus();
                }
            });
        }

        function fetchOccuredCondition() {
            if ($(".header__search-overlay .no-results").is(":visible")) {
                return "search_unsuccessful";
            } else if ($(".header__search-overlay .results_content").is(":visible")) {
                return "search_successful_many_results";
            } else if ($(".header__search-overlay .search-results-container__correction-text").is(":visible")) {
                return "search_successful_one_result";
            } else {
                return "search_not_pressed";
            }
        }

        function removePagination() {
            count = 0;
            createPaginationSearch();
            $(".results_pagination").addClass("d-none");
        }

        function truncate(string, length) {
            if (string.length > length)
                return string.substring(0, length) + '...';
            else
                return string;
        }

        function searchServiceCall(url, query, guessTotalFlag, e) {
            query = query.replace(/  +/g, ' ').trim();
            count = 0;
            if (guessTotalFlag.indexOf('false') > -1) {
                totalSearchResults = 0;
            }
            var frontEnd = $(".overlay-search-results-container").attr("data-front-end");
            var site = $(".search-trigger__search-box").attr("data-site");
            searchStart = 1;

            if (searchPaginationNumber == undefined || searchPaginationNumber == 0) {
                queryString = 'q=' + encodeURIComponent(query) + '&num=' + numSearchResults + '&start=0&collection=' + site + '&guessTotal=' + guessTotalFlag;
                searchEnd = searchListCount;
            } else {
                queryString = 'q=' + encodeURIComponent(query) + '&num=' + numSearchResults + '&start=' + searchPaginationNumber + '&collection=' + site + '&guessTotal=' + guessTotalFlag;
                searchStart += searchPaginationNumber;
                searchEnd = searchPaginationNumber + searchListCount;
            }
            $(".results_content").remove();
            $(".js-searchSuggestion").children().remove();
            var resultsListHTML = "";
            var gmUniqueSearchUrls = [];
            var showGMResults = true;
            if (queryString.indexOf("start=0") == -1) {
                showGMResults = false;
            }
            $.ajax({
                url: url,
                dataType: 'json',
                data: queryString,
                type: 'GET',
                async: false,
                success: function (data) {

                    if (data.hasOwnProperty("spelling")) {
                        $(".form-item__display").addClass("d-none");
                        $(".search-results-container__correction-text").removeClass("d-none");
                        var correctSpelling = data.spelling;
                        var newchar = ' ';
                        correctSpelling = correctSpelling.split(' ').join(newchar);
                        $(".no-results").addClass('d-none');
                        var correctionHtml = '<a href="#">' + correctSpelling + '</a>';
                        $(".js-searchSuggestion").append(correctionHtml);
                        didYouMean = correctSpelling;
                        $(".suggestion-val").text($(".search-trigger__search-box").val().trim());
                        $(".search-trigger").addClass("error");
                    } else {
                        $(".search-results-container__correction-text").addClass("d-none");
                        didYouMean = null;
                    }

                    // Suggested results don't know if needed
                    if (data.hasOwnProperty("results") && data.results.length > 0) {
                        $(".search-trigger").removeClass("error");
                        $(".popular-search-container").addClass("d-none");
                        $(".form-item__display").removeClass("d-none");

                        $(".page-count").removeClass('d-none');
                        if (didYouMean == null) {
                            $(".search-results-container__correction-text").addClass("d-none");
                        }
                        if (guessTotalFlag.indexOf('false') > -1) {
                            totalSearchResults = data.totalMatches;
                        }
                        var siteSearchResults = data.results;
                        var siteSearchResultsUrl;
                        var siteSearchResultsTitle;
                        var siteSearchResultsContent;
                        var mimeType;
                        var resultsIndex;

                        if (siteSearchResults.length != 0) {
                            $('.form-item__display').removeClass('d-none');
                            // $(".page-count").removeClass('d-none');
                            $(".no-results").addClass('d-none');


                            //results_content is the default component for listing out general results
                            resultsListHTML += "<div class=\"results_content\">";
                            for (var i = 0; i < siteSearchResults.length; i++) {
                                count++;
                                siteSearchResultsUrl = siteSearchResults[i].path;
                                siteSearchResultsTitle = siteSearchResults[i].pageTitle;
                                siteSearchResultsContent = siteSearchResults[i].excerpt;
                                if (searchPaginationNumber == undefined || searchPaginationNumber == 0) {
                                    resultsIndex = i + 1;
                                } else {
                                    resultsIndex = searchPaginationNumber + i + 1;
                                }
                                resultsListHTML += "<div class=\"list__item\">";
                                if (siteSearchResults[i].mimeType !== undefined) {
                                    var mimeTypeFinal = siteSearchResults[i].mimeType;
                                    var assetPDFTitle = siteSearchResults[i].assetPDFTitle;
                                    var assetPDFDescription = siteSearchResults[i].assetPDFDescription;
                                    if ("application/octet-stream" == mimeTypeFinal) {
                                        var fileType = siteSearchResultsUrl.substring(siteSearchResultsUrl(".") + 1);
                                        switch (fileType) {
                                            case "png":
                                            case "jpeg":
                                            case "jpg":
                                                mimeTypeFinal = "image/png";
                                                break;
                                            case "pdf":
                                                mimeTypeFinal = "application/pdf";
                                                break;
                                            case "zip":
                                            case "tgz":
                                            case "jar":
                                            case "rar":
                                            case "tar":
                                                mimeTypeFinal = "application/zip";
                                                break;
                                            case "eps":
                                                mimeTypeFinal = "application/eps";
                                                break;
                                            case "ppt":
                                                mimeTypeFinal = "application/vnd.ms-powerpoint";
                                                break;
                                            case "doc":
                                            case "docx":
                                            case "odt":
                                            case "rtf":
                                                mimeTypeFinal = "application/msword";
                                                break;
                                            case "xls":
                                            case "xlsx":
                                                mimeTypeFinal = "application/vnd.ms-excel";
                                                break;
                                            case "ai":
                                                mimeTypeFinal = "application/illustrator";
                                        }
                                    }
                                    switch (mimeTypeFinal) {
                                        case "application/pdf":
                                            mimeType = "(PDF)";
                                            break;
                                        case "image/jpeg":
                                        case "image/png":
                                        case "image/gif":
                                            mimeType = "(IMG)";
                                            break;
                                        case "application/zip":
                                        case "application/x-tar":
                                            mimeType = "(ZIP)";
                                            break;
                                        case "application/illustrator":
                                            mimeType = "(AI)";
                                            break;
                                        case "application/postscript":
                                        case "application/eps":
                                        case "application/x-eps":
                                        case "image/eps":
                                        case "image/x-eps":
                                            mimeType = "(EPS)";
                                            break;
                                        case "application/vnd.ms-excel":
                                        case "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":
                                        case "application/vnd.openxmlformats-officedocument.spreadsheetml.template":
                                        case "application/vnd.ms-excel.sheet.macroEnabled.12":
                                        case "application/vnd.ms-excel.template.macroEnabled.12":
                                        case "application/vnd.ms-excel.addin.macroEnabled.12":
                                            mimeType = "(XLS)";
                                            break;
                                        case "application/vnd.ms-powerpoint":
                                        case "application/vnd.openxmlformats-officedocument.presentationml.presentation":
                                        case "application/vnd.openxmlformats-officedocument.presentationml.template":
                                        case "application/vnd.openxmlformats-officedocument.presentationml.slideshow":
                                        case "application/vnd.ms-powerpoint.addin.macroEnabled.12":
                                        case "application/vnd.ms-powerpoint.presentation.macroEnabled.12":
                                            mimeType = "(PPT)";
                                            break;
                                        case "application/msword":
                                        case "application/vnd.openxmlformats-officedocument.wordprocessingml.document":
                                        case "application/vnd.openxmlformats-officedocument.wordprocessingml.template":
                                        case "application/vnd.ms-word.document.macroEnabled.12":
                                            mimeType = "(DOC)";
                                            break;
                                        default:
                                            mimeType = "";
                                    }

                                    if (assetPDFTitle != "" && assetPDFDescription != "") {
                                        resultsListHTML += "<a data-results-index=" + resultsIndex + " class=\"list__item__anchor res_results\" href=\"" + siteSearchResultsUrl + "\" download>" + siteSearchResultsTitle + "</a>";
                                        resultsListHTML += "<div class=\"list__excerpt asset_desc\">" + truncate(assetPDFDescription, 150) + "</div>";
                                        resultsListHTML += "<div>";
                                        resultsListHTML += "<a class=\"list__item__anchor_asset_title asset-link\" href=\"" + siteSearchResultsUrl + "\" download>" + assetPDFTitle + "</a>";
                                        resultsListHTML += "<span>" + mimeType + "</span>";
                                        resultsListHTML += "</div>";
                                    } else if (assetPDFTitle != "" && assetPDFDescription == "") {
                                        resultsListHTML += "<a data-results-index=" + resultsIndex + " class=\"list__item__anchor res_results\" href=\"" + siteSearchResultsUrl + "\" download>" + siteSearchResultsTitle + "</a>";
                                        resultsListHTML += "<div>";
                                        resultsListHTML += "<a class=\"list__item__anchor_asset_title asset-link\" href=\"" + siteSearchResultsUrl + "\" download>" + assetPDFTitle + "</a>";
                                        resultsListHTML += "<span>" + mimeType + "</span>";
                                        resultsListHTML += "</div>";
                                    } else if (assetPDFTitle == "" && assetPDFDescription != "") {
                                        resultsListHTML += "<a data-results-index=" + resultsIndex + " class=\"list__item__anchor res_results\" href=\"" + siteSearchResultsUrl + "\" download>" + siteSearchResultsTitle + "</a>";
                                        resultsListHTML += "<div class=\"list__excerpt asset_desc\">" + truncate(assetPDFDescription, 150) + "</div>";
                                        resultsListHTML += "<div>";
                                        resultsListHTML += "<a class=\"list__item__anchor_asset_title asset-link\" href=\"" + siteSearchResultsUrl + "\" download>" + siteSearchResultsTitle + "</a>";
                                        resultsListHTML += "<span>" + mimeType + "</span>" + "</a>";
                                        resultsListHTML += "</div>";
                                    } else if (assetPDFTitle == "" && assetPDFDescription == "") {
                                        resultsListHTML += "<div>";
                                        resultsListHTML += "<a data-results-index=" + resultsIndex + " class=\"list__item__anchor res_results asset-link\" href=\"" + siteSearchResultsUrl + "\" download>" + siteSearchResultsTitle + "</a>";
                                        resultsListHTML += "<span>" + mimeType + "</span>";
                                        resultsListHTML += "</div>";
                                    }
                                } else {
                                    resultsListHTML += "<a data-results-index=" + resultsIndex + " class=\"list__item__anchor res_results\" href=\"" + siteSearchResultsUrl + "\">" + siteSearchResultsTitle + "</a>";
                                    if (siteSearchResultsContent != "") {
                                        resultsListHTML += "<p class=\"list__excerpt\">" + truncate(siteSearchResultsContent, 150) + "</p>";
                                    }
                                }
                                resultsListHTML += "</div>";
                            }
                            resultsListHTML += "</div>";
                        }

                    } else {
                        $('.form-item__display').addClass('d-none');
                        $(".page-count").addClass('d-none');
                        $(".search-trigger").addClass("error");

                        if (data.hasOwnProperty("spelling")) {
                            $(".popular-search-container").addClass("d-none");
                        } else {
                            $(".no-results").html(defaultNoResultsMsg);
                            $(".no-results").removeClass('d-none');
                            $(".popular-search-container").removeClass("d-none");
                            totalSearchResults = 0;
                        }
                    }
                    $(resultsListHTML).insertAfter($(".search-results-container__correction-text"));

                    createPaginationSearch(totalSearchResults);
                    $(".search-trigger").addClass("search-initiated");
                    //AnalyticsDTM.addSearchResultsListener(totalSearchResults);
                    //AnalyticsDTM.siteSearchResults(query, totalSearchResults);

                    // Removing search results drop down options based on results count
                    if (totalSearchResults <= 10) {
                        $(".page-count").find("option:eq(1),option:eq(2)").remove();
                        $(".page-count").prop("disabled", true);
                    } else if (totalSearchResults > 10 && totalSearchResults <= 20) {
                        $(".page-count").prop("disabled", false);
                        if ($(".page-count").find("option:eq(1)").length == 0) {
                            $(".page-count").append("<option value='20'>20</option>");
                        }
                        $(".page-count").find("option:eq(2)").remove();
                    } else if (totalSearchResults > 20) {
                        $(".page-count").prop("disabled", false);
                        if ($(".page-count").find("option:eq(1)").length == 0) {
                            $(".page-count").append("<option value='20'>20</option>");
                        }
                        if ($(".page-count").find("option:eq(2)").length == 0) {
                            $(".page-count").append("<option value='30'>30</option>");
                        }
                    }

                    if (totalSearchResults >= numSearchResults) {
                        $(".page-count").val(numSearchResults);
                    } else {
                        if (totalSearchResults <= 10) {
                            $(".page-count").val("10");
                        } else if (totalSearchResults > 10 && totalSearchResults <= 20) {
                            $(".page-count").val("20");
                        } else if (totalSearchResults > 20) {
                            $(".page-count").val("30");
                        }
                    }

                    // Analytics
                    $('.search-results-container .results_content a.gm_results').on("click", function () {
                        var view;
                        if (UtilityModule.getViewport() == "mobile") {
                            view = "mobile list";
                        } else {
                            if ($(this).closest(".overlay-search-results-container").hasClass("grid-layout")) {
                                view = "grid";
                            } else {
                                view = "list";
                            }
                        }
                        var ldo = {
                            eventName: 'SearchlinkClick ',
                            attributes: {
                                method: 'suggested_results',
                                positionNum: $(this).attr("data-results-index"),
                                linkName: $(this).text().replace(/\|/g, ''),
                                linkUrl: $(this).attr('href'),
                                searchTerm: $("#searchInPage").val(),
                                view: view
                            }
                        };
                        digitalData.eventTrack('SearchlinkClick', ldo);
                    });

                    $('.overlay-search-results-container .results_content a.res_results').on("click", function () {
                        var view;
                        if (UtilityModule.getViewport() == "mobile") {
                            view = "mobile list";
                        } else {
                            if ($(this).closest(".overlay-search-results-container").hasClass("grid-layout")) {
                                view = "grid";
                            } else {
                                view = "list";
                            }
                        }

                        var ldo = {
                            eventName: 'SearchlinkClick ',
                            attributes: {
                                method: 'search_results',
                                positionNum: $(this).attr("data-results-index"),
                                linkName: $(this).text().replace(/\|/g, ''),
                                linkUrl: window.location.origin + $(this).attr('href'),
                                searchTerm: $("#searchInPage").val(),
                                view: view
                            }
                        };
                        digitalData.eventTrack('SearchlinkClick', ldo);
                    });


                },
                error: function (e) {
                    removePagination();
                },
                timeout: 30000
            });
        }

        function createPaginationSearch(totalSearchResults) {
            var startPage;
            $('.results_content').children().removeClass('.d-none');
            // Setting totalSearchResults to 0 manually when only undefined are returned
            if (typeof totalSearchResults != 'undefined') {
                if (totalSearchResults.count == 0)
                    totalSearchResults = 0;
            }
            //If there are less total results than the number of results to show
            if (totalSearchResults <= searchListCount) {
                $('.results_pagination').addClass('d-none');
                $(".results_content").children().removeClass('d-none');
                searchEnd = totalSearchResults;
            } else {
                $('.results_pagination').removeClass('d-none');
                if (searchPaginationPrev != undefined) {
                    startPage = searchPaginationPrev;
                } else {
                    startPage = 1;
                }
            }
            if (searchEnd < totalSearchResults) {
                $('.search-count > span:first-of-type').html(searchStart + '&nbsp;' + '-' + '&nbsp;' + searchEnd);
            } else {
                $('.search-count > span:first-of-type').html(searchStart + '&nbsp;' + '-' + '&nbsp;' + totalSearchResults);
            }


            if (searchCounter == 1) {
                paginationBootPage(startPage);
                $(".first a").attr("aria-label", $('.results-first-pagination').val());
                $(".prev a").attr("aria-label", $('.results-prev-pagination').val());
                $(".next a").attr("aria-label", $('.results-next-pagination').val());
                $(".last a").attr("aria-label", $('.results-last-pagination').val());
                searchCounter++;
            }

            //No results
            if (totalSearchResults == 0) {
                $('.total-count').addClass('d-none');
                $('.results_pagination').addClass('d-none');
            } else {
                $('.total-count').removeClass('d-none');
                $('.total-count').html('&nbsp;' + totalSearchResults);
            }
            $('.results_pagination ul li a').each(function () {
                var currentPage = $(this).closest("li").data('lp');
                $(this).attr('aria-label', goToText + ' ' + currentPage);
            });
            var currentPage = $('.results_pagination ul li.active').data('lp');
            $('.results_pagination ul li.active a').attr('aria-label', $('.results-current-pagination').val() + ' ' + currentText + ' ' + currentPage);
        }

        function paginationBootPage(startPage) {
            $('.results_pagination').bootpag({
                total: Math.ceil(totalSearchResults / searchListCount),
                page: startPage,            // default page
                maxVisible: searchMaxPagCount,
                leaps: false,
                firstLastUse: true,
                first: "&#10094;&#10094;",
                prev: "&#10094",
                last: "&#10095;&#10095;",
                next: "&#10095;"
            }).unbind().on("page", function (event, num, scroll) {

                searchPaginationPrev = 1;

                searchPaginationNumber = (num * searchListCount) - searchListCount;
                sessionStorage.setItem("paginationNumber", num);
                var searchRequest = $(".search-trigger__search-box").val();
                var url = $(".search-trigger__search-box").attr("data-search-ajax-url");
                if (searchRequest) {

                    searchServiceCall(url, searchRequest, "true");

                }

                if ($(".overlay-search-results-container").length > 0) {
                    if (sessionStorage.getItem("paginationNumber") !== null) {
                        var thisItem = sessionStorage.getItem("paginationNumber");

                        $(".pagination.bootpag li").each(function () {
                            $(this).removeClass("active");
                            if ($(this).attr("data-lp") == thisItem) {
                                $(this).addClass("active");
                                if (typeof scroll == "undefined") {
                                    $(".header__search-overlay").animate({scrollTop: $('#searchInPage').offset().top}, 750, function () {
                                        $(".first a").attr("aria-label", $('.results-first-pagination').val());
                                        $(".prev a").attr("aria-label", $('.results-prev-pagination').val());
                                        $(".next a").attr("aria-label", $('.results-next-pagination').val());
                                        $(".last a").attr("aria-label", $('.results-last-pagination').val());
                                    });
                                }
                                $("ul.pagination li.active a").focus();

                            }
                            if ($(this).hasClass("prev") || $(this).hasClass("next") || $(this).hasClass("first")) {
                                $(this).removeClass("active");
                            }
                        });
                        var cid = sessionStorage.getItem('digitialDataCampaignID');
                        var queryParam = sessionStorage.getItem('digitialDataQueryParametersCampaign');
                        sessionStorage.setItem('digitialDataCampaignID', cid);
                        sessionStorage.setItem('digitialDataQueryParametersCampaign', queryParam);
                        window.sessionStorage.clear();
                    }
                }


                if (searchEnd > totalSearchResults) {
                    searchEnd = totalSearchResults;
                }

                if (searchEnd < totalSearchResults) {
                    $('.search-count > span:first-of-type').html(searchStart + '&nbsp;' + '-' + '&nbsp;' + searchEnd);
                } else {
                    $('.search-count > span:first-of-type').html(searchStart + '&nbsp;' + '-' + '&nbsp;' + totalSearchResults);

                }


                $(this).bootpag({maxVisible: searchMaxPagCount});
                $('.results_pagination ul li a').each(function () {
                    var currentPage = $(this).closest("li").data('lp');
                    $(this).attr('aria-label', goToText + ' ' + currentPage);
                });
                var currentPage = $('.results_pagination ul li.active').data('lp');
                $('.results_pagination ul li.active a').attr('aria-label', $('.results-current-pagination').val() + ' ' + currentText + ' ' + currentPage);
                $("ul.pagination li.active a").focus();
                $('#pageNum').text('selected page number ' + num);
                setTimeout(function () {
                    $('#pageNum').text('');
                }, 1000);
            });
            $('.overlay-search-results-container .results_pagination ul li').click(function () {
                if (!$(this).hasClass("disabled")) {
                    $(".header__search-overlay").animate({scrollTop: $('#searchInPage').offset().top}, 750, function () {
                        $(".first a").attr("aria-label", $('.results-first-pagination').val());
                        $(".prev a").attr("aria-label", $('.results-prev-pagination').val());
                        $(".next a").attr("aria-label", $('.results-next-pagination').val());
                        $(".last a").attr("aria-label", $('.results-last-pagination').val());
                    });
                    $("ul.pagination li.active a").focus();
                    return false;
                }

            });

            $(document).on("keydown", ".overlay-search-results-container .results_pagination ul li a", function (e) {
                if (e.keyCode === 13 || e.keyCode === 32) {
                    $(this).click();
                    $("ul.pagination li.active a").focus();
                }
            });
        }

        function searchRequestProcess() {
            if ($(".search-trigger__search-box").length > 0) {
                searchRequest = $(".search-trigger__search-box").val();
                var url = $(".search-trigger__search-box").attr("data-search-ajax-url");

                if (searchRequest) {
                    //AnalyticsDTM.addSearchResultsListener();
                    searchStart = 1;
                    searchEnd = 10;
                    searchPaginationPrev = undefined;
                    searchPaginationNumber = 0;
                    searchCounter = 1;
                    searchServiceCall(url, searchRequest, "false");

                    // Analytics
                    var ldo = {
                        eventName: 'siteSearchResults',
                        attributes: {
                            resultsNum: totalSearchResults,
                            searchTerm: searchRequest
                        }
                    };
                    digitalData.eventTrack('siteSearchResults', ldo);

                    $(".overlay-search-results-container").css({
                        'opacity': 0,
                    }).stop(true, false).animate({'opacity': 1}, 2000);
					$(".overlay-search-results-container").addClass("searchClicked");
                }
            }

        }

        return {
            init: function () {
                $(window).on("resize", function () {
                    if (UtilityModule.getViewport() == 'mobile') {
                        if (searchMaxPagCount == 5) {
                            searchMaxPagCount = 3;
                        }
                    }
                    if (UtilityModule.getViewport() != 'mobile') {
                        if (searchMaxPagCount != 5) {
                            searchMaxPagCount = 5;
                        }
                    }

                    viewportNew = UtilityModule.getViewport();
                    if (viewportNew != viewportOld) {
                        if (viewportOld == "tablet" && viewportNew == "desktop") {
                            viewportOld = viewportNew;
                        } else if (viewportOld == "desktop" && viewportNew == "tablet") {
                            viewportOld = viewportNew;
                        } else {
                            viewportOld = viewportNew;
                            var num = $(".header__search-overlay-section .pagination.bootpag li.active").attr("data-lp");
                            $(".header__search-overlay-section .pagination.bootpag").trigger("page", [num, "scroll"]);
                        }
                    }
                });


                $(".page-count").on('change', function () {
                    if ($(".overlay-search-results-container").length > 0) {
                        searchListCount = parseInt($(this).val());
                        numSearchResults = $(this).val();
                        searchPaginationNumber = 0;
                        searchRequest = $('.search-trigger__search-box').val();
                        var url = $('.search-trigger__search-box').attr("data-search-ajax-url");
                        if (searchRequest) {
                            searchCounter = 1;
                            searchPaginationPrev = 1;
                            searchServiceCall(url, searchRequest, "true");
                        }
                    }
                });

                // Need to update this for search suggestion
                $('.js-searchSuggestion').on('click', function (e) {
                    e.preventDefault();
                    searchRequest = $(this).text();
                    $('.search-trigger__search-box').val($(this).text());
                    var url = $('.search-trigger__search-box').attr("data-search-ajax-url");
                    if (searchRequest) {
                        searchStart = 1;
                        searchEnd = 10;
                        searchPaginationPrev = undefined;
                        searchPaginationNumber = 0;
                        searchCounter = 1;
                        searchServiceCall(url, searchRequest, "false");
                    }
                });


                // Site header search on keypress
                $('.search-trigger__search-box').on("keypress", function (e) {
                    $('.suggestionsbox').attr('aria-hidden', 'false');
                    if (e.which == 13) {
                        e.preventDefault();
                        if ($('.search-trigger__search-box').val()) {
                            searchRequestProcess();
                            clear_suggestions();
                        }
                    }
                });

                // Site Header Search click on icon
                $('.js-searchIcon').on("click", function () {
                    if ($('.search-trigger__search-box').val()) {
                        searchRequestProcess();
                        clear_suggestions();
                    }
                });
                $(".search_location_image").on('focus', function () {
                    clear_suggestions();
                    if ($(".ss-gac-table").css('display') === 'none') {
                        $('.suggestionsbox').attr('aria-hidden', 'true');
                    } else {
                        $('.suggestionsbox').attr('aria-hidden', 'false');
                    }
                });
                $(".search_location_image").on("keyup", function (e) {
                    //e.preventDefault();
                    if (e.which == 13 || e.which == 32) {
                        if ($('.search-trigger__search-box').val()) {
                            searchRequestProcess();
                            clear_suggestions();
                        }
                    }
                    if (e.which == 9) {
                        trapTab();
                    }
                });
              $(".search_location_image").on("click", function (e) {
                    e.preventDefault();
                    if ($('.search-trigger__search-box').val()) {
                         searchRequestProcess();
                        clear_suggestions();
                    }
                });
                /*$(".search_location_image").on("keydown", function (e) {
                    e.preventDefault();
                    if($(e.keyCode===13 || e.keyCode===32)){
                    if ($('.search-trigger__search-box').val()) {
                         searchRequestProcess();
                        clear_suggestions();
                    }
                    }
                });*/

                $(".suggestionsbox").on("click", ".js-searchSuggestions", function () {
                    searchRequestProcess();
                    clear_suggestions();
                }).on("keypress", ".js-searchSuggestions", function (e) {
                    if (e.which == 13) {
                        e.preventDefault();
                        $('.search-trigger__search-box').val($(this).text());
                        if ($('.search-trigger__search-box').val()) {
                            searchRequestProcess();
                            clear_suggestions();
                        }
                    }
                });

                $(".search-results-layout .icon-search-list").attr("aria-pressed", true);
                $(".search-results-layout .icon-search-list .search_svg").addClass("active");


                $(".search-results-layout .icon-search-list").on("click", function () {
                    $(".icon-search-grid").closest(".overlay-search-results-container").removeClass("grid-layout");
                    $(".icon-search-grid .search_svg").removeClass("active");
                    $(".search-results-layout .icon-search-grid").removeClass("active").attr('aria-pressed', false);
                    $(this).addClass("active").attr('aria-pressed', true).focus().focusin();
                    $(".icon-search-list .search_svg").addClass("active");
                });

                $(document).on("keydown", ".search-results-layout .icon-search-list", function (evt) {
                    $(".icon-search-grid").closest(".overlay-search-results-container").removeClass("grid-layout");
                    if (13 === evt.keyCode || 32 === evt.keyCode) {
                        $(".search-results-layout .icon-search-grid").removeClass("active");
                        $(".icon-search-grid .search_svg").removeClass("active");
                        $(this).addClass("active").focus().focusin();
                        $(".search-results-layout .icon").removeAttr("aria-pressed");
                        $(".icon-search-list .search_svg").addClass("active");
                        $(".search-results-layout .icon-search-list").attr("aria-pressed", true);
                    }
                });

                $(".search-results-layout .icon-search-grid").on("click", function () {
                    $(".search-results-layout .icon-search-list").removeClass("active").attr('aria-pressed', false);
                    $(".icon-search-list .search_svg").removeClass("active");
                    $(this).addClass("active").attr('aria-pressed', true).focus().focusin();
                    $(this).closest(".overlay-search-results-container").addClass("grid-layout");
                    $(".icon-search-grid .search_svg").addClass("active");
                });

                $(document).on("keydown", ".search-results-layout .icon-search-grid", function (evt) {
                    if (13 === evt.keyCode || 32 === evt.keyCode) {
                        $(".icon-search-list .search_svg").removeClass("active");
                        $(".search-results-layout .icon-seach-list").removeClass("active").attr('aria-pressed', false);
                        $(this).addClass("active").focus().focusin();
                        $(this).closest(".overlay-search-results-container").addClass("grid-layout");
                        $(".search-results-layout .icon-search-grid .search_svg").addClass("active");
                        $(".search-results-layout .icon").removeAttr("aria-pressed");
                        $(".search-results-layout .icon-search-grid").attr("aria-pressed", true);
                    }
                });

                $("body").on("click", ".popular-search-item", function () {
                    $(".search-trigger__search-box").val($(this).attr("data-search-term").trim());
                    $('.js-searchIcon').trigger("click");
                    AnalyticsModule.linkClick("Search", "Popular Searches", $(this).attr("data-search-term").trim());
                }).on("keypress", ".popular-search-item", function (e) {
                    if (e.which == 13) {
                        $(".search-trigger__search-box").val($(this).attr("data-search-term").trim());
                        $('.js-searchIcon').trigger("click");
                        AnalyticsModule.linkClick("Search", "Popular Searches", $(this).attr("data-search-term").trim());
                    }
                });
                $('#searchInPage').on('keyup', function (e) {
                    if (e.keyCode == 38 || e.keyCode == 40) {
                        $(this).attr('aria-activedescendant', $(this).val());
                    }
                });
            }
        };
    })();
    LuceneSearchModule.init();
}

if("undefined"!=$(".header__search-overlay #isLucene").val()&&$(".header__search-overlay #isLucene").val()&&(0!=$("#searchInPage").length||0!=$("#form-refineSearchQuery_sr").length)){var ss_form_element="metSearchForm",enableSuggestions=!0,ss_popup_element="search_suggest",ss_popup_element_table="search_suggest_table",ss_allow_debug=!1,ss_wait_millisec=500,ss_delay_millisec=30,ss_seq=["g"],ss_g_one_name_to_display="Suggestion",ss_g_more_names_to_display="Suggestions",ss_g_max_to_display=5,ss_max_to_display=12,ss_minlength_for_suggessions=3,ss_cached=[],ajaxURL=$(".search-trigger__container input").attr("data-search-url"),site=$(".js-searchSubmit").attr("data-site");null==site&&(site=$(".search-trigger__container input").attr("data-site"));var textOverLayDivBack="overlayerback",textBoxID="searchInPage",maxCharLen=21,autoCompleteEnable=!0,scheduler=null,failCount=0,failCountMaxTries=3,ss_qbackup=null,ss_qshown=null,ss_loc=-1,ss_waiting=0,ss_painting=!1,ss_key_handling_queue=null,ss_painting_queue=null,ss_dismissed=!1,ss_panic=!1,SS_ROW_CLASS="ss-gac-a",SS_ROW_SELECTED_CLASS="ss-gac-b";Array.indexOf||(Array.prototype.indexOf=function(e){for(var s=0;s<this.length;s++)if(this[s]==e)return s;return-1});var ss_debug=new ss_Debugger,cacheTimeOut=18e5,timeStamp=(new Date).getTime(),isThemeMode=!0,maxLengthFirstRow=21,maxLenghtSecondRow=35,textEntered;function setSearchResultsPageIDS(){isThemeMode&&(clear_suggestions(),maxLengthFirstRow=27,maxLenghtSecondRow=40,clear_suggestions(),ss_form_element="frm_refineSearchResult",textOverLayDivBack="overlayerback_sr",textBoxID="form-refineSearchQuery_sr",maxCharLen=21,autoCompleteEnable=!0,ss_popup_element_table="search_suggest_table_sr",ss_popup_element="search_suggest_sr",isThemeMode=!1)}function setThemePageIDS(){isThemeMode||(clear_suggestions(),maxLengthFirstRow=21,maxLenghtSecondRow=31,ss_form_element="metSearchForm",textOverLayDivBack="overlayerback",textBoxID="searchInPage",maxCharLen=24,autoCompleteEnable=!0,ss_popup_element_table="search_suggest_table",ss_popup_element="search_suggest",isThemeMode=!0)}function clear_suggestions(){ss_dismissed=!0,ss_clear(),0!=$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".overlay-search-results-container").length&&$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".overlay-search-results-container").removeClass("d-none")}function clearCache(){ss_cached=[],timeStamp=(new Date).getTime(),scheduler=setTimeout("clearCache()",cacheTimeOut)}function doGetCaretPosition(e){var s=0;if(document.selection){e.focus();var t=document.selection.createRange();t.moveStart("character",-e.value.length),s=t.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(s=e.selectionStart);return s}function drawTextBox(e){drawTextBox(e,null)}function isNonPrintableCharacter(e){if(null!=e){if(void 0===e.which)return!0;if("number"==typeof e.which&&e.which>0)return!e.ctrlKey&&!e.metaKey&&!e.altKey&&8!=e.which}return!1}function drawTextBox(e,s){var t=-1;null!=s&&(t=window.event?window.event.keyCode:s.keyCode);var n=document.getElementById(textBoxID),a=document.getElementById(textOverLayDivBack);null!=s&&textEntered==n.value||(textEntered=n.value,n.value.length<maxCharLen?37!=t&&39!=t&&(null!=e&""!=e?(a.style.color="silver",a.style.visibility="visible",a.value=n.value+e):a.style.visibility="hidden"):a.style.color="#ffffff")}function ss_composeSuggestUri(e,s){var t=ajaxURL;return e?t=t+"?q="+encodeURIComponent(e)+"&max="+ss_g_max_to_display+"&collection="+site:null}function ss_suggest(qVal){var startTimeMs=(new Date).getTime();ss_cached[qVal]||(ss_cached[qVal]={});var suggestForm=document.getElementById(ss_form_element),uri=ss_composeSuggestUri(qVal,suggestForm);if(uri){var url=uri,xmlhttp=XH_XmlHttpCreate(),handler=function(){if(xmlhttp.readyState==XML_READY_STATE_COMPLETED){var suggested;null!=xmlhttp.status&&200!=xmlhttp.status?failCount++:failCount=0,failCount>=failCountMaxTries&&("undefined"!=typeof console&&console.info("suggestions disabled "+failCount),enableSuggestions=!1);try{suggested=eval("("+xmlhttp.responseText+")"),autocompleteList=suggested}catch(e){return ss_cached[qVal].g=null,void ss_show(qVal)}if(null==scheduler&&(scheduler=setTimeout("clearCache()",cacheTimeOut)),ss_use.g)try{var suggestions=suggested.results;if(suggestions&&suggestions.length>0){var found=!1;ss_cached[qVal].g=[];for(var max=ss_g_max_to_display<=0?suggestions.length:Math.min(ss_g_max_to_display,suggestions.length),si=0;si<max;si++)if(suggestions[si].name&&suggestions[si].name!=suggested.query)ss_cached[qVal].g[si]={q:suggestions[si].name},found=!0;else if(ss_allow_non_query){var title=suggestions[si].content,url=suggestions[si].moreDetailsUrl;url&&(title=title||ss_non_query_empty_title,ss_cached[qVal].g[si]={t:title,u:url},found=!0)}found||(ss_cached[qVal].g=null)}else ss_cached[qVal].g=null}catch(e){ss_cached[qVal].g=null}if(ss_allow_debug&&ss_debug&&ss_debug.getDebugMode()){var stopTimeMs=(new Date).getTime();ss_debug.addRequestDebugLine(qVal,"suggest",stopTimeMs-startTimeMs,ss_cached[qVal])}ss_show(qVal)}};XH_XmlHttpGET(xmlhttp,url,handler)}}function ss_processed(e){return!(!ss_cached[e]&&ss_use.g)}function ss_handleAllKey(e){if(enableSuggestions)switch(window.event?window.event.keyCode:e.keyCode){case 40:case 38:break;case 9:ss_qbackup=null,ss_dismissed=!0,ss_clear(!0);break;case 16:ss_qbackup=null,ss_dismissed=!0;var s=document.getElementById(ss_form_element).query.value;ss_processed(s)||ss_suggest(s);break;case 113:if(!ss_allow_debug)break;ss_debug&&ss_debug.getDebugMode()?ss_debug.deactivateConsole():ss_debug.activateConsole()}}function isBlockedChar(e){return keyArr=[17,20,16,18,9,112,113,114,115,116,117,118,119,120,121,122,123,91,92,93,45,33,34,144,145,19],Array.prototype.contains=function(e){for(var s=0;s<this.length;s++)if(this[s]==e)return!0;return!1},keyArr.contains(e)}function showSuggestionResults(e,s){var t=(o=document.getElementById(ss_popup_element)).getElementsByTagName("tr"),n=window.event?window.event.keyCode:s.keyCode,a=ss_qbackup||e.query.value,l=0,o=document.getElementById(ss_popup_element);if(!isBlockedChar(n))switch(n){case 40:if(ss_dismissed=!1,ss_processed(a)){if((l=ss_countSuggestions(a))>0){if("hidden"==o.style.visibility){ss_show(a);break}for(ss_qbackup?ss_loc++:(ss_qbackup=a,ss_loc=0);ss_loc>=l;)ss_loc-=l;t=o.getElementsByTagName("tr");for(var i=0;i<t.length-1;i++)t[i].className=i==ss_loc+1?SS_ROW_SELECTED_CLASS:SS_ROW_CLASS;(u=ss_locateSuggestion(a,ss_loc)).q?e.query.value=u.q:e.query.value=ss_qbackup}}else ss_suggest(a);break;case 38:if(ss_dismissed=!1,ss_processed(a)){if((l=ss_countSuggestions(a))>0){if("hidden"==o.style.visibility){ss_show(a);break}for(ss_qbackup?ss_loc--:(ss_qbackup=a,ss_loc=-1);ss_loc<0;)ss_loc+=l;for(t=o.getElementsByTagName("tr"),i=1;i<t.length-1;i++)t[i].className=i==ss_loc+1?SS_ROW_SELECTED_CLASS:SS_ROW_CLASS;(u=ss_locateSuggestion(a,ss_loc)).q?e.query.value=u.q:e.query.value=ss_qbackup}}else ss_suggest(a);break;case 13:var r=null;if(ss_processed(a)&&ss_qbackup&&ss_loc>-1)(u=ss_locateSuggestion(ss_qbackup,ss_loc)).u&&(r=u.u);ss_qbackup=null,ss_dismissed=!0,ss_clear(),r&&(window.location.href=r);break;case 27:ss_qbackup&&(e.query.value=ss_qbackup,ss_qbackup=null),ss_dismissed=!0,ss_clear();break;case 37:autoCompleteEnable=!1;break;case 16:case 9:break;case 35:autoCompleteEnable||(autoCompleteEnable=!0);break;case 39:if(ss_dismissed)return;if(!(doGetCaretPosition(e.query)>=e.query.value.length)){autoCompleteEnable=!1;break}if(!autoCompleteEnable){autoCompleteEnable=!0;break}if(ss_dismissed=!1,ss_processed(a)&&(l=ss_countSuggestions(a))>0){var _="";(u=ss_locateSuggestion(a,0)).q&&(_=u.q);for(i=1;i<t.length-1;i++){var u;if(t[i].className==SS_ROW_SELECTED_CLASS)(u=ss_locateSuggestion(ss_qbackup,ss_loc=i-1)).q&&(_=u.q)}u.q&&(e.query.value=_,drawTextBox(""))}clear_suggestions();break;default:ss_dismissed=!1,e.query.value==ss_qshown||(ss_key_handling_queue&&clearTimeout(ss_key_handling_queue),ss_qbackup=null,ss_loc=-1,ss_waiting++,ss_allow_debug&&ss_debug&&ss_debug.getDebugMode()&&ss_debug.addWaitDebugLine(e.query.value,"queue",ss_wait_millisec),ss_key_handling_queue=setTimeout('ss_handleQuery("'+ss_escape(e.query.value)+'", '+ss_waiting+")",ss_wait_millisec))}}function ss_handleKey(e){var s,t=document.getElementById(ss_form_element);t.query.value.length>0&&(s&&clearTimeout(s),s=setTimeout(function(){enableSuggestions||showSuggestionResults(t,e)},1e3)),t.query.value.length<ss_minlength_for_suggessions?(enableSuggestions=!1,clear_suggestions()):enableSuggestions=!0,enableSuggestions&&showSuggestionResults(t,e)}function ss_handleQuery(e,s){s==ss_waiting&&(ss_waiting=0,""==e?ss_clear():ss_processed(e)?ss_show(e):e.length>=3&&ss_suggest(e))}function ss_sf(){document.getElementById(ss_form_element).query.focus(),ss_dismissed=!1}function ss_clear(e){drawTextBox(""),ss_qshown=null;var s=document.getElementById(ss_form_element);ss_hide(ss_qbackup||s.query.value)}function ss_hide(e){var s=document.getElementById(ss_popup_element);"visible"==s.style.visibility&&(ss_allow_debug&&ss_debug&&ss_debug.getDebugMode()&&ss_debug.addHideDebugLine(e,"hide"),s.style.visibility="hidden",document.getElementById(ss_popup_element_table).style.visibility="hidden",document.getElementById(ss_popup_element_table).style.display="none",document.getElementById(ss_popup_element_table).style.position="",document.getElementById(ss_popup_element_table).style.height="",document.getElementById(ss_popup_element_table).style.width="",document.getElementById(ss_popup_element_table).style.background="",0!=$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".popular-search-container").length&&$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".popular-search-container").parent().removeClass("d-none"),0!=$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".overlay-search-results-container").length&&$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".overlay-search-results-container").removeClass("d-none"))}function ss_show(e){if(document.getElementById(ss_form_element).query.value==e){var s=(new Date).getTime();if(ss_dismissed)return ss_qshown=null,void ss_hide(e);if(ss_processed(e))if(""!=e){var t=ss_cached[e]?ss_cached[e].g:null,n=!1;if(ss_use.g&&t&&(n=!0),!n)return ss_qshown=null,void ss_hide(e);if(ss_painting)return ss_painting_queue&&clearTimeout(ss_painting_queue),ss_allow_debug&&ss_debug&&ss_debug.getDebugMode()&&ss_debug.addWaitDebugLine(e,"delay",ss_delay_millisec),void(ss_painting_queue=setTimeout('ss_show("'+ss_escape(e)+'")',ss_delay_millisec));ss_painting=!0;for(var a=document.getElementById(ss_popup_element),l=a.rows.length-1;l>-1;l--)a.deleteRow(l);for(var o=0,i=0;i<ss_seq.length;i++){switch(ss_seq[i]){case"g":o+=ss_showSuggestion(t,o,a,e)}if(ss_max_to_display>0&&o>=ss_max_to_display)break}if(o>0){var r=a.insertRow(-1);r.className="ss-gac-e";var _=document.createElement("td");_.setAttribute("tabindex","0"),_.colSpan=2;var u=document.createElement("span");if(u.onclick=function(){ss_qbackup=null,ss_clear();var e=document.getElementById(ss_form_element).query.value;ss_processed(e)||(ss_dismissed=!0,ss_suggest(e))},u.appendChild(document.createTextNode("close")),_.appendChild(u),r.appendChild(_),a.style.visibility="visible",0!=$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".popular-search-container").length&&$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".popular-search-container").parent().addClass("d-none"),0!=$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".overlay-search-results-container").length&&$("#"+ss_popup_element_table).closest(".header__search-overlay").find(".overlay-search-results-container").addClass("d-none"),document.getElementById(ss_popup_element_table).style.visibility="visible",document.getElementById(ss_popup_element_table).style.position="absolute",document.getElementById(ss_popup_element_table).style.height="100vh",document.getElementById(ss_popup_element_table).style.width="100%",document.getElementById(ss_popup_element_table).style.background="#fff",document.getElementById(ss_popup_element_table).style.display="block",ss_qshown=e,ss_allow_debug&&ss_debug&&ss_debug.getDebugMode()){var d=(new Date).getTime();ss_debug.addShowDebugLine(e,d-s,ss_cached[e],o)}}else ss_hide(e);ss_painting=!1}else ss_hide(e)}else ss_allow_debug&&ss_debug&&ss_debug.getDebugMode()&&ss_debug.addHideDebugLine(e,"skip")}function ss_showSuggestion(e,s,t,n){if(ss_max_to_display>0&&s>=ss_max_to_display)return 0;if(e&&e.length>0){lqry=n.toLowerCase().replace(/\"/g,"");var a=t.insertRow(-1);a.className=SS_ROW_CLASS;var l=document.createElement("td");l.setAttribute("tabindex","0"),l.className="ss-gac-c js-searchSuggestions";var o="";o=1==e.length?ss_g_one_name_to_display:ss_g_more_names_to_display;var i=document.createElement("td");i.setAttribute("tabindex","0"),i.appendChild(document.createTextNode(o)),i.className="ss-gac-d",a.appendChild(l),a.appendChild(i);for(var r=0;r<e.length;r++){var _=t.insertRow(-1);_.onclick=ss_handleMouseC,_.onmousemove=ss_handleMouseM,_.className=SS_ROW_CLASS;var u=document.createElement("td");if(e[r].q){var d=e[r].q;d.length>maxLenghtSecondRow&&(d=d.substr(0,maxLenghtSecondRow)+"...");var c='<b style="color: #000000;">'+d.substr(0,lqry.length)+"</b>";e[r].q.length>lqry.length&&(c+=d.substring(lqry.length),0==r&&drawTextBox(e[r].q.substring(lqry.length))),u.innerHTML=c}else u.innerHTML="<i>"+e[r].t+"</i>";if(u.className="ss-gac-c js-searchSuggestions",_.appendChild(u),u.colSpan=2,ss_max_to_display>0&&s+r+1>=ss_max_to_display)return r+1}return e.length}return 0}function ss_handleMouseM(){for(var e=document.getElementById(ss_form_element),s=document.getElementById(ss_popup_element).getElementsByTagName("tr"),t=1;t<s.length-1;t++)if(s[t]==this&&s[t].className!=SS_ROW_SELECTED_CLASS){s[t].className=SS_ROW_SELECTED_CLASS,ss_qbackup||(ss_qbackup=e.query.value);var n=ss_locateSuggestion(ss_qbackup,ss_loc=t-1);n.q?(e.query.value=n.q,drawTextBox("")):(e.query.value=ss_qbackup,drawTextBox(""))}else s[t]!=this&&(s[t].className=SS_ROW_CLASS);return ss_sf(),!0}function ss_handleMouseC(){document.getElementById(ss_form_element);for(var e=document.getElementById(ss_popup_element).getElementsByTagName("tr"),s=0;s<e.length-1;s++)if(e[s]==this){var t=e[s].getElementsByTagName("td");$("#searchInPage,#Search").val($(t)[0].innerText);var n=$(".search-trigger__search-box").val();$(".search-trigger__search-box").hasClass("js-oldSearch")&&UtilityModule.legacySearch(n)}}function ss_countSuggestions(e){for(var s=0,t=0;t<ss_seq.length;t++){switch(ss_seq[t]){case"g":s+=ss_cached[e].g?ss_cached[e].g.length:0}if(ss_max_to_display>0&&s>=ss_max_to_display)return ss_max_to_display}return s}function ss_locateSuggestion(e,s){for(var t=0,n=0,a=0;a<ss_seq.length;a++){switch(ss_seq[a]){case"g":n+=ss_cached[e].g?ss_cached[e].g.length:0}if(s>=t&&s<n){switch(ss_seq[a]){case"g":var l=ss_cached[e].g[s-t].q;return l?{q:l}:{u:ss_cached[e].g[s-t].u}}break}t=n}return null}function ss_escape(e){return e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')}function ss_escapeDbg(e){for(var s="",t=e.split(""),n=0;n<t.length;n++)switch(t[n]){case"&":s+="&amp;";break;case"<":s+="&lt;";break;case">":s+="&gt;";break;default:s+=t[n]}return s}function ss_Debugger(){this.debugMode=!1}suggestionsSearch=function(){},ss_Debugger.DEBUG_CONSOLE_ID="ss_debug_console",ss_Debugger.DEBUG_CONTENT_ID="ss_debug_content",ss_Debugger.DEBUG_TOGGLE_ID="ss_debug_toggle",ss_Debugger.prototype.getDebugMode=function(){return this.debugMode},ss_Debugger.prototype.activateConsole=function(){var e=document.getElementById(ss_Debugger.DEBUG_CONSOLE_ID);if(e)e.style.display="block";else{var s=document.createElement("div");s.id=ss_Debugger.DEBUG_CONSOLE_ID,s.zIndex=100,s.className="expanded";var t=document.createElement("h1");t.appendChild(document.createTextNode("GSA Suggest Debug Console")),t.style.display="inline",s.appendChild(t);var n=document.createElement("div");n.style.float="right";var a=document.createElement("button");a.onclick=function(e){var s=document.getElementById(ss_Debugger.DEBUG_CONTENT_ID);if(s)for(var t=s.rows.length-1;t>0;t--)s.deleteRow(t)},a.appendChild(document.createTextNode("Clear console")),n.appendChild(a),(a=document.createElement("button")).onclick=function(e){ss_cached=[]},a.appendChild(document.createTextNode("Clear cache")),n.appendChild(a),(a=document.createElement("button")).id=ss_Debugger.DEBUG_TOGGLE_ID,a.onclick=function(e){var s=document.getElementById(ss_Debugger.DEBUG_CONSOLE_ID);if(s){var t=document.getElementById(ss_Debugger.DEBUG_TOGGLE_ID);-1!=s.className.indexOf("expanded")?(s.className=s.className.replace(/expanded/,"contracted"),t.innerHTML="Maximize"):(s.className=s.className.replace(/contracted/,"expanded"),t.innerHTML="Minimize")}},a.appendChild(document.createTextNode("Minimize")),n.appendChild(a),n.style.display="inline",s.appendChild(n),s.appendChild(document.createElement("br"));var l=document.createElement("table");l.id=ss_Debugger.DEBUG_CONTENT_ID;var o=l.insertRow(-1),i=document.createElement("th");i.innerHTML="Query",o.appendChild(i),(i=document.createElement("th")).innerHTML="Type",o.appendChild(i),(i=document.createElement("th")).innerHTML="Time",o.appendChild(i),(i=document.createElement("th")).innerHTML="g",o.appendChild(i),(i=document.createElement("th")).innerHTML="Total",o.appendChild(i),s.appendChild(l),document.body.appendChild(s)}this.debugMode=!0},ss_Debugger.prototype.deactivateConsole=function(){var e=document.getElementById(ss_Debugger.DEBUG_CONSOLE_ID);e&&(e.style.display="none"),this.debugMode=!1},ss_Debugger.prototype.addRequestDebugLine=function(e,s,t,n){var a=document.getElementById(ss_Debugger.DEBUG_CONTENT_ID);if(a){var l=a.insertRow(1),o=document.createElement("td");switch(o.innerHTML="&lt;"+ss_escapeDbg(e)+"&gt;",l.appendChild(o),(o=document.createElement("td")).innerHTML=s,l.appendChild(o),(o=document.createElement("td")).className="no",o.innerHTML=t+" ms",l.appendChild(o),s){case"suggest":(o=document.createElement("td")).className="no",o.innerHTML=n.g?n.g.length:0,l.appendChild(o),o=document.createElement("td"),l.appendChild(o);break;default:o=document.createElement("td"),l.appendChild(o),o=document.createElement("td"),l.appendChild(o)}}},ss_Debugger.prototype.addShowDebugLine=function(e,s,t,n){var a=document.getElementById(ss_Debugger.DEBUG_CONTENT_ID);if(a){var l=a.insertRow(1),o=document.createElement("td");o.innerHTML="&lt;"+ss_escapeDbg(e)+"&gt;",l.appendChild(o),(o=document.createElement("td")).innerHTML="<i>show</i>",l.appendChild(o),(o=document.createElement("td")).className="no",o.innerHTML=s+" ms",l.appendChild(o),(o=document.createElement("td")).className="no",o.innerHTML=t&&t.g?t.g.length:0,l.appendChild(o),(o=document.createElement("td")).className="no",o.innerHTML=n,l.appendChild(o)}},ss_Debugger.prototype.addHideDebugLine=function(e,s){var t=document.getElementById(ss_Debugger.DEBUG_CONTENT_ID);if(t){var n=t.insertRow(1),a=document.createElement("td");a.innerHTML="&lt;"+ss_escapeDbg(e)+"&gt;",n.appendChild(a),(a=document.createElement("td")).innerHTML="<i>"+s+"</i>",n.appendChild(a),(a=document.createElement("td")).className="no",a.innerHTML="0 ms",n.appendChild(a),a=document.createElement("td"),n.appendChild(a),a=document.createElement("td"),n.appendChild(a)}},ss_Debugger.prototype.addWaitDebugLine=function(e,s,t){var n=document.getElementById(ss_Debugger.DEBUG_CONTENT_ID);if(n){var a=n.insertRow(1),l=document.createElement("td");l.innerHTML="&lt;"+ss_escapeDbg(e)+"&gt;",a.appendChild(l),(l=document.createElement("td")).innerHTML="<i>"+s+"</i>",a.appendChild(l),(l=document.createElement("td")).className="no",l.innerHTML=t+" ms",a.appendChild(l),l=document.createElement("td"),a.appendChild(l),l=document.createElement("td"),a.appendChild(l)}};var ss_use={};ss_use.g=ss_seq.indexOf("g")>=0}
